{
  "hash": "cfc6fd4521f4e79d5a49be4b1b25c07c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"How old is that Possum?\"\nsubtitle: \"Using Linear Regression to Predict the Age of Possum\"\ncategories: [Machine Learning, Linear Regression]\ncode-fold: true\ncode-copy: hover\ncode-summary: \"Show the code\"\nimage: image.jpg\nfooter: \"Image from freepik.com\"\nbibliography: possum.bib\ndate: 2024-08-20\n---\n\n\n# Introduction\n\nThis project aims to predict the age of possums collected from three different sites in Australia. The sites are Victoria, New South Wales and Queensland. New South Wales and Queensland are compressed into a single category \"Others\". The data is available in the DAAG R package developed by @maindonald2015package.\n\n![Cute Possum](cute-possum.jpg){width=\"400\"}\n\nThe data is having the following properties:\n\nS/N|Variable name | Definition |\n|:-----|:------:|:-------|\n|1. |case | Observation number|\n|2. |site | The site number where the possum was trapped.|\n|3. |Pop | The site as Vic (Victoria) or Other (New South Wales and Queensland)|\n|4. |sex | Gender, either m (male) or f (female).|\n|5. |age | Age of possum|\n|6. |hdlngth | Head length, in mm.|\n|7. |skullw | Skull width, in mm.|\n|8. |totlngth | Total length, in cm.|\n|9. |taill | Tail length, in cm.|\n|10. |footlgth | Foot length in mm|\n|11. |earconch | Ear conch length in mm|\n|12. |eye | distance from medial canthus to lateral canthus of right eye|\n|13. |chest | chest girth (in cm)|\n|14. |belly | belly girth (in cm)|\n\n\n::: {.cell}\n\n:::\n\n\n## Loading the data\n\n::: {.cell}\n\n```{.r .cell-code}\npsm <- DAAG::possum |> janitor::clean_names() |> \n  remove_rownames() |> as_tibble()\n```\n:::\n\n\nAfter getting any data, the first thing to do is trying to understand the data\n\n\n::: {#tbl-summary .cell tbl-cap='Summary statistics of possum data' tbl-subcap='true'}\n\n```{.r .cell-code}\nskimr::skim_without_charts(psm)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |psm  |\n|Number of rows           |104  |\n|Number of columns        |14   |\n|_______________________  |     |\n|Column type frequency:   |     |\n|factor                   |2    |\n|numeric                  |12   |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts       |\n|:-------------|---------:|-------------:|:-------|--------:|:----------------|\n|pop           |         0|             1|FALSE   |        2|oth: 58, Vic: 46 |\n|sex           |         0|             1|FALSE   |        2|m: 61, f: 43     |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|  mean|    sd|   p0|   p25|   p50|   p75|  p100|\n|:-------------|---------:|-------------:|-----:|-----:|----:|-----:|-----:|-----:|-----:|\n|case          |         0|          1.00| 52.50| 30.17|  1.0| 26.75| 52.50| 78.25| 104.0|\n|site          |         0|          1.00|  3.62|  2.35|  1.0|  1.00|  3.00|  6.00|   7.0|\n|age           |         2|          0.98|  3.83|  1.91|  1.0|  2.25|  3.00|  5.00|   9.0|\n|hdlngth       |         0|          1.00| 92.60|  3.57| 82.5| 90.68| 92.80| 94.73| 103.1|\n|skullw        |         0|          1.00| 56.88|  3.11| 50.0| 54.98| 56.35| 58.10|  68.6|\n|totlngth      |         0|          1.00| 87.09|  4.31| 75.0| 84.00| 88.00| 90.00|  96.5|\n|taill         |         0|          1.00| 37.01|  1.96| 32.0| 35.88| 37.00| 38.00|  43.0|\n|footlgth      |         1|          0.99| 68.46|  4.40| 60.3| 64.60| 68.00| 72.50|  77.9|\n|earconch      |         0|          1.00| 48.13|  4.11| 40.3| 44.80| 46.80| 52.00|  56.2|\n|eye           |         0|          1.00| 15.05|  1.05| 12.8| 14.40| 14.90| 15.72|  17.8|\n|chest         |         0|          1.00| 27.00|  2.05| 22.0| 25.50| 27.00| 28.00|  32.0|\n|belly         |         0|          1.00| 32.59|  2.76| 25.0| 31.00| 32.50| 34.12|  40.0|\n\n\n:::\n:::\n\n\n@tbl-summary-1 shows that data was collected on 104 possum's. There are 2 categorical variables, `pop` and `sex`, but this should be three as site should also be a categorical variable (check below to see transformation of this variable). The `case` variable is not needed and can be removed. There are missing data in `age` and `footlgth` variables, @tbl-summary-2. We can remove this missing data points as it's not a lot, @fig-missing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisdat::vis_miss(psm)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-missing-1.png){#fig-missing width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npsm <- psm |> \n  drop_na() |> \n  select(-case) |> \n  mutate(\n    site = factor(\n      site, \n      levels= 1:7,\n      labels = c(\"Cambarville\", \"Bellbird\", \"Whian Whian\",\n                \"Byrangery\", \"Conondale\", \"Allyn River\", \"Bulburin\")\n    )\n  )\n```\n:::\n\n\n# Exploratory Data Analysis\nTo understand the data, we do an EDA for targets and predictors.\n\n## Univariate Analysis - Target\n\n::: {#tbl-mct-age .cell tbl-cap='Descriptive Statistics for Possum Age'}\n\n```{.r .cell-code}\npsm |> \n  summarize(\n    median_age = median(age),\n    mean_age = round(mean(age), 2),\n    minimum_age = min(age),\n    maximum_age = max(age)\n  ) |> kable(\n    col.names = c(\"Median\", \"Mean\", \"Min\", \"Max\"),\n    align = \"lccr\",\n    caption = \"Measure of Central Tendency for Age\"\n  )\n```\n\n::: {.cell-output-display}\n\n\nTable: Measure of Central Tendency for Age\n\n|Median | Mean | Min | Max|\n|:------|:----:|:---:|---:|\n|3      | 3.82 |  1  |   9|\n\n\n:::\n:::\n\n\n@tbl-mct-age shows a spread mean and median value for age which might indicates that the distribution is skewed or bimodal, see @fig-age.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsm |> \n  ggplot(aes(age)) +\n  geom_density(col = \"#ab2493\") +\n  labs(\n    x = \"Age\",\n    y = \"Density\",\n    title = \"Age variable showing a bimodal distribution\"\n  )\n```\n\n::: {.cell-output-display}\n![Distribution of Age variable](index_files/figure-html/fig-age-1.png){#fig-age width=672}\n:::\n:::\n\n\n## Univariate Analysis of Features\n\n### Factors\n\n#### Regions and Sites (Trap Locations)\n\n\n::: {#fig-pop-reg .cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\npsm |> \n  mutate(\n    pop = case_when(\n      pop == \"Vic\" ~ \"Victoria\",\n      .default = \"Others\"\n    )\n  ) |> \n  ggplot(aes(pop)) +\n  geom_bar(fill = \"cadetblue4\") +\n  expand_limits(y = c(0, 70)) +\n  labs(\n    x = \"Population\",\n    y = \"Frequency\",\n    title = \"Population of Registered Possums According to Regions\"\n  ) +\n  theme(plot.title = element_text(face = \"bold\", hjust = .5))\n\npsm |> \n  count(site) |> \n  arrange(n) |> \n  ggplot(aes(n, fct_reorder(site, n))) +\n  geom_bar(\n    stat = \"identity\",\n    fill = \"coral2\"\n  ) +\n  labs(\n    y = \"Sites\",\n    x = \"Count\",\n    title = \"Population of Registered Possums According to Sites\"\n  ) +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = .5)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-pop-reg-1.png){#fig-pop-reg-1 width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-pop-reg-2.png){#fig-pop-reg-2 width=672}\n:::\n\nRegistered Possum Population Record\n:::\n\n\nMore possums were recorded at the region labelled **Other** @fig-pop-reg. We should recall that **Other** is the combination of records from New South Wales and Queensland. For the sites where trap where placed within the regions, **Cambarville** have the highest record of possums with more than half the second site, **Bulburin**.\n\n### Numerical Variables\n\n\n::: {#tbl-desc-stat .cell tbl-cap='Measure of Central Tendency for Numerical Variable'}\n\n```{.r .cell-code}\npsm_long <- psm |> \n  pivot_longer(\n    cols = hdlngth:belly,\n    names_to = \"variables\",\n    values_to = \"values\"\n  )\n\npsm_long |> \n  summarize(\n    .by = variables,\n    mean = mean(values),\n    median = median(values),\n    minimum = min(values),\n    maximum = max(values)\n  ) |> \n  kable(\n    col.names = c(\"Variable\", \"Mean\", \"Median\", \"Minimum\", \"Maximum\"),\n    align = \"lcccr\"\n  )\n```\n\n::: {.cell-output-display}\n\n\n|Variable |   Mean   | Median | Minimum | Maximum|\n|:--------|:--------:|:------:|:-------:|-------:|\n|hdlngth  | 92.73069 |  92.9  |  82.5   |   103.1|\n|skullw   | 56.96040 |  56.4  |  50.0   |    68.6|\n|totlngth | 87.26931 |  88.0  |  75.0   |    96.5|\n|taill    | 37.04951 |  37.0  |  32.0   |    43.0|\n|footlgth | 68.39802 |  67.9  |  60.3   |    77.9|\n|earconch | 48.13366 |  46.8  |  41.3   |    56.2|\n|eye      | 15.05049 |  14.9  |  12.8   |    17.8|\n|chest    | 27.06436 |  27.0  |  22.0   |    32.0|\n|belly    | 32.63861 |  32.5  |  25.0   |    40.0|\n\n\n:::\n:::\n\n@tbl-desc-stat shows the measure of central tendency. The difference between median and mean is minimal indicating a normal distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadditional_colors <- c(\"#af4242\", \"#535364\", \"#FFC300\")\nset_swatch(c(unique(swatch()), additional_colors))\n\npsm_long |> \n  ggplot(aes(values, col = variables)) +\n  geom_density() +\n  scale_color_discrete() +\n  facet_wrap(~variables, scales = \"free\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Numerical variable distribution](index_files/figure-html/fig-num-dist-1.png){#fig-num-dist width=672}\n:::\n:::\n\n\nAll the numerical variables are normally distributed @fig-num-dist. `earconch`, `footlgth`, `taill`, and `totlngth` are bimodals.\n\n## Multivariate Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsm |>\n  mutate(\n    pop = case_when(\n      pop == \"Vic\" ~ \"Victoria\",\n      .default = \"Others\"\n    )\n  ) |> \n  ggplot(aes(site, age, fill = pop, col = \"#000\")) +\n  geom_violin(inherit.aes = FALSE, aes(site, age)) +\n  geom_boxplot(position = \"dodge\", width = .2) +\n  geom_jitter(size = .5) +\n  facet_wrap(~pop, scales = \"free\") +\n  coord_flip() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `scale_name` argument of `discrete_scale()` is deprecated as of ggplot2\n3.5.0.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Correlation Matrix\n\n::: {.cell}\n\n```{.r .cell-code}\nggcorr(\n  psm,\n  geom = \"text\",\n  low = \"#219123\",\n  mid = \"#e09263\",\n  high = \"#8f0123\"\n)\n```\n\n::: {.cell-output-display}\n![Correlation Matrix](index_files/figure-html/fig-cor-mat-1.png){#fig-cor-mat width=672}\n:::\n:::\n\n\nThe correlation of the variables to `age` is low with the maximum correlation being with `belly`, @fig-cor-mat. However, there's high correlation between the predictors and to prevent collinearity we could consider employing Principal Component Analysis to transform correlated predictors to uncorrelated predictor. More information on the relationships existing between the variables can be seen in @fig-pairs.\n\n::: {.cell}\n\n```{.r .cell-code}\nggpairs(psm)\n```\n\n::: {.cell-output-display}\n![Generalized pairs plot](index_files/figure-html/fig-pairs-1.png){#fig-pairs width=672}\n:::\n:::\n\n\n\n# Modeling\n\n## Data Sharing\n@fig-age shows how older possums from age 8 to 9 are not well represented in the data. A stratified data sharing technique will be employed to account for less represented age data point.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(124)\npsm_split <- initial_split(psm, prop = .75, strata = age)\npsm_train <- training(psm_split)\n```\n:::\n\n\nIf we check @fig-train, possums that are 8 and 9 years old are represented.\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_train |> \n  count(age) |> \n  ggplot(aes(factor(age), n)) +\n  geom_col() +\n  geom_text(\n    aes(label = n),\n    nudge_y = .5,\n    col = \"red\"\n  ) +\n  labs(\n    x = \"Age\",\n    y = \"Count\",\n    title = \"Age Frequency in Training Data\"\n  )\n```\n\n::: {.cell-output-display}\n![Age data point frequency in training data](index_files/figure-html/fig-train-1.png){#fig-train width=672}\n:::\n:::\n\n\nTo prevent data leaking, the data will be resampled to have a validation-training data in 10 folds using the k-folds resampling.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(124)\npsm_folds <- vfold_cv(psm_train, v = 10)\n```\n:::\n\n\n## Model Specification\nWe will use linear regression to predict the age of possums\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_spec <- linear_reg() |> \n  set_engine(\"lm\")\nlm_spec |> translate()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n\nModel fit template:\nstats::lm(formula = missing_arg(), data = missing_arg(), weights = missing_arg())\n```\n\n\n:::\n:::\n\n\n## Feature engineering\nThree preprocessing will be added to formular specification. These are:\n\n-   Normalizing, centering and scaling numerical variables\n-   PCA to reduce collinearity between numeric variables\n-   Creating dummy variables for categorical data.\n\nThese preprocesses are added as presented down to the last step which is creating dummy variables for categorical data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_rec_1 <- recipe(age ~ ., data = psm_train)\n\npsm_rec_2 <- psm_rec_1 |> \n  step_normalize(all_numeric_predictors()) |> \n  step_center(all_numeric_predictors()) |> \n  step_scale(all_numeric_predictors())\n\npsm_rec_3 <- psm_rec_2 |> \n  step_pca(all_numeric_predictors())\n\npsm_rec_4 <- psm_rec_3 |>\n  step_dummy(all_factor_predictors()) \n```\n:::\n\n\n\nThe result from applying the whole steps is shown in @tbl-preproc-table\n\n\n::: {#tbl-preproc-table .cell tbl-cap='Data look after preprocessing'}\n\n```{.r .cell-code}\npsm_rec_4 |> \n  prep() |> \n  juice() |> \n  kable()\n```\n\n::: {.cell-output-display}\n\n\n| age|        PC1|        PC2|        PC3|        PC4|        PC5| site_Bellbird| site_Whian.Whian| site_Byrangery| site_Conondale| site_Allyn.River| site_Bulburin| pop_other| sex_m|\n|---:|----------:|----------:|----------:|----------:|----------:|-------------:|----------------:|--------------:|--------------:|----------------:|-------------:|---------:|-----:|\n|   2| -0.0683403| -1.3430047|  0.1629385| -0.3007284| -0.5391333|             0|                0|              0|              0|                0|             0|         0|     0|\n|   1|  0.5255119| -2.0477985| -0.8395109|  0.1766334| -0.0667790|             0|                0|              0|              0|                0|             0|         0|     0|\n|   2|  0.5932377| -1.9591624|  0.3740650|  0.6887651|  0.0693626|             0|                0|              0|              0|                0|             0|         0|     1|\n|   2| -0.2120375| -2.2111365|  1.7088223| -0.3387357| -0.0931182|             0|                0|              0|              0|                0|             0|         0|     1|\n|   2| -2.7210452| -1.3894871|  0.2290110|  0.7561382|  1.2385934|             0|                0|              0|              0|                0|             0|         0|     0|\n|   2| -1.6707158| -1.6525644|  0.3608677| -0.3541424| -0.3539676|             0|                0|              0|              0|                0|             0|         0|     0|\n|   2| -1.3813568| -1.6981681| -0.0280696|  0.7534030|  0.9919553|             1|                0|              0|              0|                0|             0|         0|     1|\n|   2| -1.5913442| -1.8659808| -0.8607981| -0.6136969| -0.3717057|             1|                0|              0|              0|                0|             0|         0|     0|\n|   2| -1.8079989| -2.3782409| -0.8116058| -2.0083817| -0.0033699|             1|                0|              0|              0|                0|             0|         0|     0|\n|   2| -1.1954515|  0.8971959| -0.0703966|  0.7598542| -0.3683068|             0|                1|              0|              0|                0|             0|         1|     1|\n|   2|  4.1803713|  0.8897649|  0.3938191| -1.1044746|  0.7567941|             0|                0|              1|              0|                0|             0|         1|     1|\n|   2|  4.6163778|  0.9891800| -1.6076608| -0.4016217|  0.8022071|             0|                0|              1|              0|                0|             0|         1|     1|\n|   1| -4.0340944|  0.7906070| -0.4034363| -0.8853157| -0.3652180|             0|                0|              0|              1|                0|             0|         1|     1|\n|   1| -4.1822396|  0.7403597|  1.4657432|  0.7862599| -0.0250014|             0|                0|              0|              1|                0|             0|         1|     1|\n|   1| -4.8749934|  1.0799429|  0.5352953|  0.7612442| -0.0609334|             0|                0|              0|              0|                1|             0|         1|     1|\n|   2|  2.5067698|  1.2854692| -0.6829234|  1.2902829|  0.2988343|             0|                0|              0|              0|                0|             1|         1|     1|\n|   2| -1.5370018|  0.2066507| -0.2442228|  0.0557942|  0.3654421|             0|                0|              0|              0|                0|             1|         1|     1|\n|   1| -3.2753856|  0.2501520|  0.5857415|  0.1900539|  1.4760626|             0|                0|              0|              0|                0|             1|         1|     1|\n|   1| -2.1384046|  0.7896655| -0.8456387|  0.4282661| -0.8568027|             0|                0|              0|              0|                0|             1|         1|     1|\n|   3|  1.1122517| -1.7400213|  0.1350000|  0.5145977|  0.8017867|             0|                0|              0|              0|                0|             0|         0|     1|\n|   3|  2.4376323| -0.1537461|  0.5696070|  0.9282523| -0.5959512|             0|                0|              0|              0|                0|             0|         0|     1|\n|   3|  2.1208772| -1.2766662| -0.5393494| -0.7589132| -0.3098302|             0|                0|              0|              0|                0|             0|         0|     1|\n|   3| -0.8479812| -1.9954784| -0.1869869|  0.7504195|  0.5086049|             0|                0|              0|              0|                0|             0|         0|     0|\n|   3| -0.2546200| -0.7339399| -0.5724089|  1.2923626|  0.3215358|             0|                0|              0|              0|                0|             0|         0|     1|\n|   3| -1.3035647| -0.9059791|  0.2567987|  1.5597938|  0.6757254|             0|                0|              0|              0|                0|             0|         0|     1|\n|   3| -1.3801925| -1.7109431| -0.8450879|  0.1415803|  0.4597025|             1|                0|              0|              0|                0|             0|         0|     0|\n|   3| -1.4546803| -2.2008308|  0.3436864| -0.9008104| -0.1966397|             1|                0|              0|              0|                0|             0|         0|     1|\n|   3|  0.5475648|  1.2161183|  1.0312910|  0.5588546|  0.0878335|             0|                1|              0|              0|                0|             0|         1|     0|\n|   3|  2.2170891|  0.9836707|  0.7951650|  0.1065218|  1.8105991|             0|                0|              1|              0|                0|             0|         1|     1|\n|   3|  1.9972559|  1.1700952| -1.4558448| -0.9730381|  1.0159799|             0|                0|              1|              0|                0|             0|         1|     1|\n|   3| -0.0160895|  2.2457175|  0.2960816|  0.3467818|  0.4165286|             0|                0|              0|              1|                0|             0|         1|     0|\n|   3| -0.2223062|  2.0686619|  1.3282648| -0.4517102| -1.1944972|             0|                0|              0|              0|                1|             0|         1|     1|\n|   3| -3.3732068|  0.9325033| -0.5077306| -0.6443673|  0.5400554|             0|                0|              0|              0|                1|             0|         1|     0|\n|   3| -0.4720101|  1.8872613| -1.1706750|  1.3286723|  0.2507486|             0|                0|              0|              0|                1|             0|         1|     1|\n|   3| -2.5900211|  1.6833673| -1.5180662|  0.4190351| -0.2681204|             0|                0|              0|              0|                1|             0|         1|     0|\n|   3|  0.5445663|  0.8323311| -0.1462565| -0.0678134|  1.1252436|             0|                0|              0|              0|                0|             1|         1|     1|\n|   3| -3.1702672|  0.7865104| -1.6716095|  0.1959689| -0.0137905|             0|                0|              0|              0|                0|             1|         1|     1|\n|   3| -2.0113676|  0.9835760| -0.4212246|  0.6511830| -0.2093714|             0|                0|              0|              0|                0|             1|         1|     1|\n|   3| -0.1882476|  1.3519467| -1.4211159| -0.4945806| -0.7699330|             0|                0|              0|              0|                0|             1|         1|     0|\n|   5|  0.8018678| -1.1017884|  0.1905308|  0.3472246|  0.0514925|             0|                0|              0|              0|                0|             0|         0|     0|\n|   5|  0.8585521| -0.4801589|  0.7640545| -0.2147241|  0.9196030|             0|                0|              0|              0|                0|             0|         0|     1|\n|   5|  0.2620327| -1.2163951|  0.8313169| -1.1950904| -0.8132611|             0|                0|              0|              0|                0|             0|         0|     1|\n|   4| -0.5062891| -1.8550529| -0.2235993| -0.4786062| -0.0109695|             0|                0|              0|              0|                0|             0|         0|     1|\n|   4|  1.2896934| -0.8353170|  0.3121114|  0.8084280| -0.9564098|             0|                0|              0|              0|                0|             0|         0|     0|\n|   4|  0.7633360| -1.4221693|  0.3320057|  0.2360456| -0.9218318|             0|                0|              0|              0|                0|             0|         0|     0|\n|   4|  1.7348293| -0.7827117| -0.5492365|  1.5939574| -0.1108831|             0|                0|              0|              0|                0|             0|         0|     0|\n|   4|  1.0074512| -1.4392717|  1.4124102| -0.6572234| -0.9983031|             1|                0|              0|              0|                0|             0|         0|     1|\n|   4|  1.2196798|  0.7318619|  0.3807984| -1.4813922| -0.5696577|             0|                1|              0|              0|                0|             0|         1|     1|\n|   5|  0.1624015|  0.9176772| -0.6018114| -0.2048875| -1.2980099|             0|                1|              0|              0|                0|             0|         1|     0|\n|   5|  1.2769012|  1.7340403|  1.7505303| -1.9506005| -1.4972834|             0|                1|              0|              0|                0|             0|         1|     0|\n|   4|  2.8730337|  1.7649283| -1.8840529| -0.0327439| -1.4752294|             0|                0|              1|              0|                0|             0|         1|     0|\n|   4| -0.7811046|  1.2505268|  1.2772509| -0.8895713|  0.9844815|             0|                0|              0|              1|                0|             0|         1|     1|\n|   5| -0.1778915|  1.8234918|  1.8421001|  0.2472064|  0.7975054|             0|                0|              0|              1|                0|             0|         1|     1|\n|   5|  0.5870791|  0.9806575| -0.4520133| -0.5907173| -0.2002764|             0|                0|              0|              1|                0|             0|         1|     1|\n|   4| -2.2936714|  1.2946467| -0.3851774|  0.0574455| -1.6155298|             0|                0|              0|              0|                1|             0|         1|     0|\n|   5|  0.3984752|  2.4505759|  1.9146399|  1.2545626| -0.3336188|             0|                0|              0|              0|                1|             0|         1|     1|\n|   4| -2.9202721|  1.6366815|  0.3851973| -0.6849716| -0.9226780|             0|                0|              0|              0|                1|             0|         1|     0|\n|   5|  0.6367704|  0.7329147| -0.5223680| -3.1495636|  1.8185866|             0|                0|              0|              0|                0|             1|         1|     1|\n|   8|  1.7826009| -1.6838293|  0.1706863| -0.2690101| -0.4859142|             0|                0|              0|              0|                0|             0|         0|     1|\n|   6|  1.1123234| -0.7925447|  0.6658510|  0.3974655| -0.0097557|             0|                0|              0|              0|                0|             0|         0|     0|\n|   6|  2.8417842| -0.6314935| -0.3153884|  1.0465569|  0.2123617|             0|                0|              0|              0|                0|             0|         0|     0|\n|   6|  1.4913213| -1.1741720| -0.0838276|  1.1679075| -0.2170689|             0|                0|              0|              0|                0|             0|         0|     0|\n|   6|  1.4425787| -1.4133157| -0.7059632|  0.3147806| -0.1514926|             0|                0|              0|              0|                0|             0|         0|     0|\n|   9|  0.9480141| -1.0555139|  0.2764188|  0.8208403| -0.1018660|             0|                0|              0|              0|                0|             0|         0|     0|\n|   6|  0.2688303| -1.0311888| -0.6140051|  0.6025036|  0.2966715|             0|                0|              0|              0|                0|             0|         0|     0|\n|   7|  2.3860203| -1.8788997| -0.1915698| -0.3147883| -1.2298158|             0|                0|              0|              0|                0|             0|         0|     1|\n|   7|  0.6864520| -1.5752069|  0.2795289| -0.1682235| -0.4540231|             1|                0|              0|              0|                0|             0|         0|     1|\n|   7| -1.4194670| -0.5106128|  1.2546762| -0.9316148|  0.3494254|             1|                0|              0|              0|                0|             0|         0|     1|\n|   6|  2.1555615|  1.8143879| -0.1552479|  0.3237445|  1.1957884|             0|                1|              0|              0|                0|             0|         1|     1|\n|   7|  3.9328351|  2.3307182|  0.9015280|  0.5265040| -0.2550755|             0|                0|              1|              0|                0|             0|         1|     1|\n|   7| -0.8366410|  0.9049272| -2.1111769| -0.2795170| -0.3564392|             0|                0|              0|              1|                0|             0|         1|     0|\n|   6|  0.4252388|  2.0484319| -0.7460744|  0.3875539| -0.1874486|             0|                0|              0|              1|                0|             0|         1|     1|\n|   6|  0.4202458|  1.4909987|  1.4297284|  0.2056943|  0.0191890|             0|                0|              0|              0|                1|             0|         1|     1|\n|   6| -0.2551146|  0.1745767| -0.5514308| -1.9875642|  1.1766109|             0|                0|              0|              0|                0|             1|         1|     1|\n\n\n:::\n:::\n\n\n\nThe numerical predictors has been reduced to 5 variables.\n\n## Model Workflow\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_wf_set <- workflow_set(\n  preproc = list(\n    \"formula\" = psm_rec_1,\n    \"normalized\" = psm_rec_2, \n    \"pca\" = psm_rec_3,\n    \"dummy\" = psm_rec_4\n  ),\n  models = list(\"ols\" = lm_spec),\n  cross = TRUE\n)\n\npsm_wf_set\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A workflow set/tibble: 4 × 4\n  wflow_id       info             option    result    \n  <chr>          <list>           <list>    <list>    \n1 formula_ols    <tibble [1 × 4]> <opts[0]> <list [0]>\n2 normalized_ols <tibble [1 × 4]> <opts[0]> <list [0]>\n3 pca_ols        <tibble [1 × 4]> <opts[0]> <list [0]>\n4 dummy_ols      <tibble [1 × 4]> <opts[0]> <list [0]>\n```\n\n\n:::\n:::\n\n\n### Fitting the model\n\n\n::: {#tbl-mod-metric .cell tbl-cap='Model metric'}\n\n```{.r .cell-code}\npsm_mod <- psm_wf_set |> \n  workflow_map(\n    \"fit_resamples\",\n    resamples = psm_folds,\n    seed = 124\n)\n\ncollect_metrics(psm_mod) |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|wflow_id       |.config              |preproc |model      |.metric |.estimator |      mean|  n|   std_err|\n|:--------------|:--------------------|:-------|:----------|:-------|:----------|---------:|--:|---------:|\n|formula_ols    |Preprocessor1_Model1 |recipe  |linear_reg |rmse    |standard   | 1.7863370| 10| 0.1001647|\n|formula_ols    |Preprocessor1_Model1 |recipe  |linear_reg |rsq     |standard   | 0.2506679| 10| 0.0642785|\n|normalized_ols |Preprocessor1_Model1 |recipe  |linear_reg |rmse    |standard   | 1.7863370| 10| 0.1001647|\n|normalized_ols |Preprocessor1_Model1 |recipe  |linear_reg |rsq     |standard   | 0.2506679| 10| 0.0642785|\n|pca_ols        |Preprocessor1_Model1 |recipe  |linear_reg |rmse    |standard   | 1.7590867| 10| 0.1122277|\n|pca_ols        |Preprocessor1_Model1 |recipe  |linear_reg |rsq     |standard   | 0.1970622| 10| 0.0555754|\n|dummy_ols      |Preprocessor1_Model1 |recipe  |linear_reg |rmse    |standard   | 1.7590867| 10| 0.1122277|\n|dummy_ols      |Preprocessor1_Model1 |recipe  |linear_reg |rsq     |standard   | 0.1970622| 10| 0.0555754|\n\n\n:::\n:::\n\n\n@tbl-mod-metric shows no difference in the model between `dummy_ols` and `pca_ols` which is different from using the formula without preprocessing, `formula_ols` and `normalized_ols`. This presented visually in @fig-mod-metric\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncollect_metrics(psm_mod) |> \n  filter(.metric == \"rmse\") |> \n  select(wflow_id, mean, std_err) |> \n  mutate(\n    ymax = mean + std_err,\n    ymin = mean - std_err\n  ) |> \n  ggplot(aes(wflow_id, mean, col = wflow_id)) +\n  geom_pointrange(aes(ymin = ymin, ymax =ymax)) +\n  labs(\n    x = \"Preproc\",\n    title = \"RMSE of Possum Linear Regression Model for 3 Preprocessor\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Model evaluation using RMSE for each preprocessor](index_files/figure-html/fig-mod-metric-1.png){#fig-mod-metric width=672}\n:::\n:::\n\nWe can use either of `pca_ols` or `dummy_ols` as they have the lowest mean.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_pca_mod <- psm_mod |> \n  extract_workflow(id = \"pca_ols\")\n\npsm_pca_mod \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n══ Workflow ════════════════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: linear_reg()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n4 Recipe Steps\n\n• step_normalize()\n• step_center()\n• step_scale()\n• step_pca()\n\n── Model ───────────────────────────────────────────────────────────────────────\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_model <- last_fit(\n  psm_pca_mod,\n  split = psm_split\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_model |> \n  collect_predictions() |> \n  select(\"prediction\" =.pred, age) |> \n  mutate(\n    prediction = ceiling(prediction),\n    residual = age - prediction\n  ) |> \n  ggplot(\n    aes(age, residual)\n  ) +\n  geom_point() +\n  geom_hline(aes(yintercept = 0), col = \"gray3\") +\n  ggtitle(\"Residual\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\nWhile the points are fairly distributed along the y axis and x axis, the effect of having little representative from the population for old-aged possum, age 9 and 8 can be see. The lack of points on the lower-right side of the plot is a good of indication.\n\n## Feature Importance\nThe features contributing the most to the model are shown in @fig-vip\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsm_model |>\n  extract_fit_parsnip() |> \n  vip::vip(\n    num_features = 10,\n    geom = \"col\"\n  ) +\n  ggtitle(\"Feature Importance\")\n```\n\n::: {.cell-output-display}\n![PC1, and Byrangery sites are the most important variables.](index_files/figure-html/fig-vip-1.png){#fig-vip width=672}\n:::\n:::\n\n\n## Summary\nWhile this a good use of linear regression, the robustness of the model would have been helped if underrepresented data points are available. By the time of writing this blog post, the author with intentions to use only SLR is having no feature engineering method to account for the age variable that has been discretized. A resampling technique such as Monte Carlo or bootstrapping is an approach that could help with the model rather than the use of k-fold resampling method.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}